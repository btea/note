## Web的攻击技术  
互联网上的攻击大都将web站点作为目标。  
### 针对web的攻击技术  
简单的HTTP协议本身并不存在安全性问题，因此协议本身几乎不会成为攻击的对象。应用HTTP协议的服务器和客户端，以及运行在服务器上的Web应用等资源才是攻击目标。   
目前，来自互联网的攻击大多是冲着Web站点来的，它们大多把Web应用作为攻击目标。  
#### HTTP不具备必要的安全功能  
与最初的设计相比，现今的Web网站应用的HTTP协议的使用方式已发生了翻天覆地的变化。几乎现今所有的Web网站都会使用会（session）管理、加密处理等安全性方面的功能，而HTTP协议内并不具备这些功能。  
从整体上看，HTTP就是一个通用的单纯协议机制。因此它具备较多优势，但是在安全性方面则呈劣势。  
就拿远程登录时会用到的SSH协议来说，SSH具备协议级别的认证及会话管理等功能，HTTP协议则没有。另外在架设SSH服务方面，任何人都可以轻易地创建安全等级高的服务，而HTTP即使已架设好服务器，但若想提供服务器基础上的Web应用，很多情况下都需要重新开发。  
因此，开发者需要自行设计并开发认证及会话管理功能来满足Web应用的安全。而自行设计就意味着会出现各种形形色色的实现。结果，安全等级并不完备，可仍在运作的Web应用背后却隐藏着各种容易被攻击者滥用的安全漏洞的Bug。  
#### 在客户端即可篡改请求  
在Web应用中，从浏览器那接收到的HTTP请求的全部内容，都可以在客户端自由地变更、篡改。所以Web应用可能会接收到与预期数据不相同的内容。  
在HTTP请求报文内加载攻击代码，就能发起对Web应用的攻击。通过URL查询字段或表单、HTTP首部、Cookie等途径把攻击代码传入，若这时Web应用存在安全漏洞，那内部信息就会遭到窃取，或被攻击者拿到管理权限。  
#### 针对web应用的攻击模式  
对web应用的攻击模式有以下两种：  
* 主动攻击  
* 被动攻击  

**以服务器为目标的主动攻击**  
主动攻击（active attack）是指攻击者通过直接访问web应用，把攻击代码传入的攻击模式。由于该模式是直接针对服务器上的资源进行攻击，因此攻击者需要能够访问到那些资源。  
主动攻击模式里具有代表性的攻击是SQL注入攻击和OS命令注入攻击。  
**以服务器为目标的被动攻击**  
被动攻击（passive attack）是指利用圈套策略执行攻击代码的攻击模式。在被动攻击过程中，攻击者不直接对目标web应用访问发起攻击。  
被动攻击通常的攻击模式如下：  
步骤1：攻击者诱使用户出发已设置好的陷阱，而陷阱会启动发送已嵌入攻击代码的HTTP请求。  
步骤2：当用户不知不觉中招之后，用户的浏览器或邮件客户端就会触发这个陷阱。  
步骤3：中招后的用户浏览器会把含有攻击代码的HTTP请求发送给作为攻击目标的web应用，运行攻击代码。  
步骤4：执行完攻击代码，存在安全漏洞的web应用会成为攻击者的跳板，可能导致用户所持的Cookie等个人信息被窃取，登录状态中的用户权限遭恶意滥用等后果。  
被动攻击模式中具有代表性的攻击是跨站脚本攻击和跨站点请求伪造。  
利用用户的身份攻击企业内部网络  
利用被动攻击，可发起对原本从互联网上无法直接访问的企业内网等网络的攻击。只要用户踏入攻击者预先设好的陷阱，在用户能够访问到的网络范围内，即使是企业内网也同样会受到攻击。  
很多企业内网依然可以连接到互联网上，访问Web网站，或接收互联网发来的邮件。这样就可能给攻击者以可乘之机，诱导用户触发陷阱后对企业内网发动攻击。  
### 因输出值转义不完全引发的安全漏洞  
实用Web应用的安全对策可大致分为以下两部分：  
* 客户端的验证  
* web应用端（服务器端）的验证   

输入值验证  
输出值转义  
多数情况下采用JavaScript在客户端验证数据。可是在客户端允许篡改数据或关闭JavaScript，不适合将JavaScript验证作为安全的防范对策。保留客户端验证只是为了尽早地辨识输入错误，起到提高UI体验的作用。  
Web应用端的输入值验证按Web应用内的处理则有可能被误认为是具有攻击性意义的代码。输入值验证通常是指检查是否是符合系统业务逻辑的数值或检查字符编码等预防对策。  
从数据库或文件系统、HTML、邮件等输出Web应用处理的数据之际，针对输出做值转义处理是一项至关重要的安全策略。当输出值转义不完全时，会因触发攻击者传入的攻击代码，而给输出对象带来损害。  
#### 跨站脚本攻击  
跨站脚本攻击（Cross-Site Scripting，XSS）是指通过存在安全漏洞的web网站注册用户的浏览器内运行非法的HTML标签或JavaScript进行的一种攻击。动态创建的HTML部分有可能隐藏着安全漏洞。就这样，攻击者编写脚本设下陷阱，用户在自己的浏览器上运行时，一不小心就会受到被动攻击。  
跨站脚本攻击可能有以下影响：  
* 利用虚假输入表单骗取用户个人信息。  
* 利用脚本窃取用户的Cookie值，被害者在不知情的情况下，帮助攻击者发起恶意请求。  
* 显示伪造的文章或图片。  

**跨站脚本攻击案例**  
在动态生成HTML处发生  
XSS攻击者利用预先设置的陷阱触发的被动攻击  
跨站脚本攻击属于被动攻击模式，因此攻击者会事先布置好用于攻击的陷阱。  
#### SQL注入攻击  
> 会执行非法SQL的SQL注入攻击  
SQL注入（SQL Injection）是指针对web应用使用的数据库，通过运行非法的SQL而产生的攻击。该安全隐患有可能引发极大的威胁，有时会直接导致个人信息及机密信息的泄露。  
web应用通常会用到数据库，当需要对数据库表内的数据进行检索或添加、删除等操作时，会使用SQL语句连接数据库进行特定的操作。如果在调用SQL语句的方式上存在疏漏，就有可能执行被恶意注入（Injection）非法SQL语句。  
SQL注入攻击有可能会造成以下等影响：  
* 非法查看或篡改数据库内的数据  
* 规避认证  
* 执行和数据库服务器业务关联的程序等  
何为SQL  
SQL是用来操作关系型数据库管理系统（Relational DataBase Management System，RDBMS）的数据库语言，可进行操作数据或定义数据等。RDBMS中有名的数据库有Oracle Database、Microsoft SQL Server、IBM DB2、MySQL和PostgreSQL等。这些数据库系统都可以把SQL作为数据库语言使用。  
使用数据库的web应用，通过某种方法将SQL语句传给RDBMS,再把RDBMS返回的结果灵活地使用在Web应用中。  
* SQL语句示例  
SELECT title,text FROM newsTbl WHERE id=123  
#### OS命令注入攻击  
OS命令注入攻击（OS Command Injection）是指通过Web应用，执行非法的操作系统命令达到攻击的目的。只要在能调用Shell函数的地方就有存在被攻击的风险。  
可以从web应用中通过Shell来调用操作系统命令。倘若调用Shell时存在漏洞，就可以执行插入的非法OS命令。  
OS命令注入攻击可以向Shell发送命令，让Windows或Linux操作系统的命令行启动程序。也就是说，通过OS注入攻击可执行OS上安装着的各种程序。  
#### HTTP首部注入攻击  
HTTP首部注入攻击（HTTP Header Injection）是指攻击者通过在响应首部字段内插入换行，添加任意响应首部或主体的一种攻击。属于被动攻击模式。  
向首部主体内添加内容的攻击称为HTTP响应截断攻击（HTTP Response Spliting Attack）。  
web应用有时会把从外部接收到的数值，赋给响应首部字段Location和Set-Cookie。  
HTTP首部注入可能像这样，通过在某些响应首部字段需要处理输出值的地方，插入换行发动攻击。  
HTTP首部注入攻击可能会造成以下影响：  
* 设置任何Cookie的信息  
* 重定向至任意URL  
* 显示任意的主体（HTTP响应截断攻击）  
* HTTP首部注入攻击案例  
#### 邮件首部注入攻击  
邮件首部注入（Mail Header Injection）是指Web应用中的邮件发送功能，攻击者通过向邮件首部To或Subject内任意添加非法内容发起的攻击。利用存在安全漏洞的web网站，可对任意邮件地址发送广告邮件或病毒邮件。  
#### 目录遍历攻击  
目录遍历（Directory Traversal）攻击是指对本无意公开的文件目录，通过非法截断目录路径后，达成访问目的的一种攻击。这种攻击有时也称为路径遍历（Path Traversal）攻击。  
通过Web应用对文件处理操作时，在由外部指定文件名的处理存在疏漏的情况下，用户可使用 .../ 等相对路径定位到 /etc/passed等绝对路径上，因此服务器上任意的文件或文件目录皆有可能被访问到。这样一来，就有可能非法浏览、篡改或删除Web服务器上的文件。  
固然存在输出值转义的问题，但更应该关闭指定对任意文件名的访问权限。  
#### 远程文件包含漏洞  
远程文件包含漏洞（Remote File Inclusion）是指部分脚本内容需要从其他文件读入时，攻击者利用指定外部服务器的URL充当依赖文件，让脚本读取之后，就可运行任意脚本的一种攻击。  
这主要是PHP存在的安全漏洞，对PHP的include或require来说，这是一种可通过设定，指定外部服务器的URL作为文件名的功能。但是，该功能太危险，PHP5.2.0之后默认设定此功能无效。  
### 因设置或设计上的缺陷引发的安全漏洞  
因设置或设计上的缺陷引发的安全漏洞是指，错误设置web服务器，或是由设计上的一些问题引起的安全漏洞。  
#### 强制浏览  
强制浏览（Forced Browsing）安全漏洞是指，从安置在web服务器的公开目录下的文件中，浏览那些原本非自愿公开的文件。  
强制浏览有可能会造成以下一些影响：  
* 泄露顾客的个人信息等重要情报  
* 泄露原本需要具有访问权限的用户才可查阅的信息内容  
* 泄露未外链到外界的文件  

对那些原本不愿公开的文件，为了保证安全会隐蔽其URL。可一旦知道了那些URL，也就意味着可浏览URL对应的文件。直接显示容易推测的文件名或文件目录索引时，通过某些方法可能会使URL产生泄露。  
#### 不正确的错误消息处理  
不正确的错误消息处理（Error Handling Vulnerability）的安全漏洞是指，Web应用的错误信息内容包含对攻击者有用的信息。与web应用有关的主要错误信息如下：  
* web应用抛出的错误信息  
* 数据库等系统抛出的错误信息  
#### 开放重定向  
开放重定向（Open Redirect）是一种对指定的任意URL作重定向跳转的功能。而与此功能相关联的安全漏洞是指，假如指定的重定向URL到某个具有恶意的web网站，那么用户就会被诱导至那个web网站。  
### 因会话管理疏忽引发的安全漏洞   
会话管理是用来管理用户状态的必备功能，但是如果在会话管理上有所疏忽，就会导致用户的认证状态被窃取等后果。  
#### 会话劫持  
会话劫持（Session Hijack）是指攻击者通过某种手段拿到了用户的会话ID,并非法使用此会话ID伪装成用户，达到攻击的目的。  
具备认证功能的Web应用，使用会话ID的会话管理机制，作为管理认证状态的主流方式。会话ID中记录客户端的Cookie等信息，服务器端将会话ID与认证状态进行一对一匹配管理。  
下面列举几种攻击者可获得会话ID的途径：  
* 通过非正规的生成方法推测会话ID  
* 通过窃听或XSS攻击盗取会话ID  
* 通过会话固定攻击（Session Fixation）强行获取会话ID  
#### 会话固定攻击  
对以窃取目标会话ID为主动攻击手段的会话劫持而言，会话固定攻击（Session Fixation）攻击会强制用户使用攻击者指定的会话ID，属于被动攻击。  
#### 跨站点请求伪造  
跨站点请求伪造（Cross-Site Request Forgeries，CSRF）攻击是值攻击者通过设置好的陷阱，强制对已完成认证的用户进行非预期的个人信息或设定信息等某些状态更新，属于被动攻击。  
跨站点请求伪造有可能会造成以下等影响：  
* 利用已通过认证的用户权限更新设定信息等  
* 利用已通过认证的用户权限购买商品  
* 利用已通过认证的用户权限在留言板上发表言论  
### 其他安全漏洞  
#### 密码破解  
密码破解攻击（Password Cracking）即算出密码，突破认证。攻击不仅限于web应用，还包括其他的系统（如FTP或SSH等）。  
密码破解有以下两种手段：  
* 通过网络的密码试错  
* 对已加密密码的破解（指攻击者入侵系统，已获得加密或散列处理的密码数据的情况）  

*通过网络进行密码试错*  
对web应用提供的认证功能，通过网络尝试候选密码进行的一种攻击。主要有以下两种方式：  
* 穷举法  
* 字典攻击  

穷举法  
穷举法（Brute-force Attack，又称暴力破解法）是指对所有秘钥集合构成的秘钥空间（Keyspace）进行穷举。即，用所有可行的候选密码对目标的密码系统试错，用以突破验证的一种攻击。  
因为穷举法会尝试所有的候选密码，所以是一种必然能够破解密码的攻击。但是，当密钥空间很庞大时，解密可能需要花费数年，甚至千年的时间，因此从现实角度考量，攻击是失败的。  
字典攻击  
字典攻击是指利用事先收集好的候选密码（经过各种组合方式后存入字典），枚举字典中的密码，尝试通过认证的一种攻击手法。  
还是举银行采用个人识别码是“4位数字”的密码的例子，考虑到用户使用自己的生日做密码的可能性较高，于是就可以把生日日期数值化，如将0101~1231保存成字典，进行尝试。  
与穷举法相比，由于需要尝试的候选密码较少，意味着攻击耗费的时间比较短。但是，如果字典中没有正确的密码，那就无法破解成功。因此攻击的成败取决于字典的内容。  
#### 点击劫持  
点击劫持（Clickjacking）是指利用透明的按钮或链接做成陷阱，覆盖在Web页面之上。然后诱使用户在不知情的情况下，点击哪个链接访问内容的一种攻击手段。这种行为又称为界面伪装（UI Redressing）。  
已设置陷阱的Web页面，表面上内容并无不妥，但早已埋入想让用户点击的链接。当用户点击到透明的按钮时，实际上是点击了已指定透明属性元素的iframe页面。  
### DoS攻击  
DoS攻击（Denial of Service attack）是一种让运行中的服务呈停止状态的攻击。有时也叫服务停止攻击或拒绝服务攻击。DoS攻击的对象不仅限于Web网站，还包括网络设备及服务器等。  
主要有以下两种DoS攻击方式：  
* 几种利用访问请求造成资源过载，资源用尽的同时，实际上服务也就呈停止状态。  
* 通过攻击安全漏洞使服务停止。  

其中，集中利用访问请求的DoS攻击，单纯来讲就是发送大量的合法请求。服务器很难分辨何为正常请求，何为攻击请求，因此很难防止DoS攻击。  
多台计算机发起的DoS攻击称为DDoS攻击（Distributed Denial of Service attack）。DDoS攻击通常利用那些感染病毒的计算机作为攻击者的攻击跳板。  
### 后门程序  
后门程序（Backdoor）是指开发设置的隐藏入口，可不按正常步骤使用受限功能。利用后门程序就能够使用原本受限制的功能。  
通常后门程序分以下3种类型：  
* 开发阶段作为Debug调用的后门程序  
* 开发者为了自身利益植入的后门程序  
* 攻击者通过某种方法设置的后门程序  

可通过监视进程或通信的状态发现被植入的后门程序。但设定在web应用中的后门程序，由于和正常使用时区别不大，通常很难发现。  




















