## 确保Web安全的HTTPS  
在HTTP协议中有可能存在信息窃听或身份伪装等安全问题。使用HTTPS通信机制可以有效地防止这些问题。  
## HTTP的缺点  
HTTP主要有这些不足，例举如下：  
* 通信使用明文（不加密），内容可能会被窃听  
* 不验证通行方身份，因此有可能遭遇伪装  
* 无法证明报文的完整性，所以有可能遭遇篡改  
这些问题不仅在HTTP上出现，其他未加密的协议中也会存在这类问题。   
除此之外，HTTP本身还有很多缺点。而且，还有像某些特定的web服务器和特定的web浏览器在实际应用中存在的不足（也可以说成是脆弱性或安全漏洞），另外，用Java和PHP等编程语言开发的web应用也可能存在安全漏洞。  
### 通信使用明文会被窃听  
由于HTTP本身不具备加密的功能，所以也无法做到对通信整体（使用HTTP协议通信的请求和响应的内容）进行加密。即，HTTP报文使用明文（指未经过加密的报文）方式发送。  
**TCP/IP是可能被窃听的网络**  
如果要问为什么通信时不加密是一个缺点，这是因为，按TCP/IP协议族的工作机制，通信内容在所有的通信线路上都有可能遭到窥视。  
所谓互联网，是由能连通到全世界的网络组成的。无论世界那个角落的服务器在和客户端通信时，在此通信线路上的某些网络设备、光缆、计算机等都不可能是个人的私有物，所以不排除某个环节中会遭到恶意窥视行为。  
即使已经过加密处理的通信，也会被窥视到通信内容，这点和未加密的通信是相同的。只是说如果通信经过加密就有可能让人无法破解报文信息的含义，但加密处理后的报文信息本身还是会被看到的。  
窃听相同段上的通信并非难事。只需要收集在互联网上流动的数据包（帧）就行了。对于收集来的数据包的解析工作，可交给那些抓包（Packet Capture）或嗅探器（Sniffer）工具。  
广泛使用的抓包工具Wireshark，可以获取HTTP协议的请求和响应内容，并对其进行解析。  
**加密处理防止被窃听**  
在目前大家正在研究的如何防止窃听保护信息的几种对策中，最为普及的就是加密技术。加密的对象可以有这么几个：  
* 通信的加密  
一种方式就是通信加密。HTTP协议中没有加密机制，但可以通过和SSL(Secure Socket Layer，安全套接层)或TLS(Transport Layer Security，安全传输层协议)的组合使用，加密HTTP的通信内容。  
用SSL建立安全通信线路之后，就可以在这条线路上进行HTTP通信了。与SSL组合使用的HTTP被称为HTTPS(HTTP Secure，超文本传输协议)或HTTP over SSL。  
* 内容的加密  
还有一种将参与通信内容本身加密的方式。由于HTTP协议中并没有加密机制，那么就对HTTP协议传输的内容本身加密。即把HTTP报文里所包含的内容进行加密。  
在这种情况下，客户端需要对HTTP报文进行加密处理后再发送请求。  
为了做到有效的内容加密，前提是要求客户端和服务器同时具备加密和解密机制。主要应用在web服务中。有一点需注意，由于该方式不同于SSL或TLS将整个通信线路加密处理，所以内容仍有被篡改的风险。  
### 不验证通信方的的身份就可能遭遇伪装  
HTTP协议中的请求和响应不会对通信方的进行确认。也就是说存在“服务器是否就是发送请求中URI真正指定的主机，返回的响应是否真的返回到实际提出请求的客户端”等类似的问题。  
**任何人都可发起请求**  
在HTTP协议通信时，由于不存在确认通信方的处理步骤，任何人都可以发起请求。另外，服务器只要接收到请求，不管对方是谁都会返回一个响应（但也仅限于发送端的IP地址和端口号没有被web服务器设定限制访问的前提下）。  
HTTP协议的视线本身非常简单，无论是谁发送过来的请求都会返回响应，因此不确认通信方，会存在以下各种隐患：  
* 无法确定发送至目标的web服务器是否是按真实意图返回响应的那台服务器。有可能是已伪装的服务器。  
* 无法确定响应返回到的客户端是否是按真实意图接收响应的那个客户端。有可能是已伪装的客户端。  
* 无法确定正在通信的对方是否具备访问权限。因为某些Web服务器上保存着重要的信息，只想发给特定用户通信的权限。  
* 无法判定请求是来自何方、出自谁手。  
* 即使是无意义的请求也会照单全收。无法阻止海量请求下的DoS攻击（Denial of Service，拒绝服务攻击）。    

**查明对手的证书**  
虽然使用HTTP协议无法确定通信方，但如果使用SSL则可以。SSL不仅提供加密处理，而且还使用了一种被称为证书的手段，可用于确定通信方。  
证书由值得信任的第三方机构颁发，用以证明服务器和客户端是实际存在的。另外，伪造证书从技术角度来说是异常困难的一件事。所以只要能够确认通信方（服 务器或客户端）持有的证书，即可判断通信方的真实意图。  
通过使用证书，以证明通信方就是意料中的服务器。这对使用者个人来讲，也减少了个人信息泄露的危险性。  
另外，客户端持有证书即可完成个人身份的确认，也可用于对Web网站的认证环节。  
### 无法证明报文完整性，可能已遭篡改  
所谓完整性是指信息的准确度。若无法证明其完整性，通常也就意味着无法判断信息是否准确。  
**接收到的内容可能有误**
由于HTTP协议无法证明通信的报文完整性，因此，在请求或响应送出之后直到对方接收之前的这段时间内，即使请求或响应的内容遭到篡改，也没有办法获悉。  
换句话说，没有任何办法确认，发出的请求/响应和接收到的请求/响应是前后是相同的。  
比如，从某个Web网站上下载内容，是无法确定客户端下载的文件和服务器上存放的文件是否前后一致的。文件内容在传输途中可能已经被篡改为其他的内容。即使内 容真的已改变，作为接收方的客户端也是觉察不到的。  
**如何防止篡改**  
虽然有使用HTTP协议确定报文完整性的办法，但事实上并不便捷、可靠。其中常用的是MD5和SHA-1等散列值校验的方法，以及用来确认文件的数字签名方法。  
提供文件下载服务的Web网站也会提供相应的以PGP（Pretty Good Privacy，完美 隐私）创建的数字签名及MD5算法生成的散列值。PGP是用来证明创建文件的数字签名，MD5是由单向函数生成的散列值。不论使用哪一种方法，都需要操纵客户端的用户本人亲自检查验证下载的文件是否就是原来服务器上的文件。浏览器无法自动帮用户检查。  
可惜的是，用这些方法也依然无法百分百保证确认结果正确。因为PGP和MD5本身被改写的话，用户是没有办法意识到的。  
为了有效防止这些弊端，有必要使用HTTPS。SSL提供认证和加密处理及摘要功能。仅靠HTTP确保完整性是非常困难的，因此通过和其他协议组合使用来实现这个目标。  

## HTTP + 加密 + 认证 + 完整性保护 = HTTPS  
### HTTP加上加密处理和认证以及完整性保护后即是HTTPS  
如果在HTTP协议通信过程中使用未经加密的明文，比如在Web页面中输入信用卡号，如果这条通信线路遭到窃听，那么信用卡号就暴露了。  
另外，对于HTTP来说，服务器也好，客户端也好，都是没有办法确认通信方的。因为很有可能并不是和原本预想的通信方在实际通信。并且还需要考虑到接收到的报文在通信途中已经遭到篡改这一可能性。  
为了统一解决上述这些问题，需要在HTTP上再加入加密处理和认证等机制。我们把添加了加密及认证机制的HTTP称为HTTPS（HTTP Secure）。  
经常会在Web的登录页面和购物结算界面等使用HTTPS通信。使用HTTPS通信时，不 再用http://，而是改用https://。另外，当浏览器访问HTTPS通信有效的Web网站时，浏览器的地址栏内会出现一个带锁的标记。对HTTPS的显示方式会因浏览器的不同而有所改变。  
### HTTPS是身披SSL外壳的HTTP  
HTTPS并非是应用层的一种新协议。只是HTTP通信接口部分用SSL（Secure Socket Layer）和TLS（Transport Layer Security）协议代替而已。  
通常，HTTP直接和TCP通信。当使用SSL时，则演变成先和SSL通信，再由SSL和TCP通信了。简言之，所谓HTTPS，其实就是身披SSL协议这层外壳的HTTP。  
在采用SSL后，HTTP就拥有了HTTPS的加密、证书和完整性保护这些功能。  
SSL是独立于HTTP的协议，所以不光是HTTP协议，其他运行在应用层的SMTP和Telnet等协议均可配合SSL协议使用。可以说SSL是当今世界上应用最为广泛的网络安全技术。  
### 相互交换秘钥的公开秘钥加密技术  
在对SSL进行讲解之前，我们先来了解一下加密方法。SSL采用一种叫做公开密钥加密（Public-key cryptography）的加密处理方式。  
近代的加密方法中加密算法是公开的，而密钥却是保密的。通过这种方式得以保持加密方法的安全性。  
加密和解密都会用到密钥。没有密钥就无法对密码解密，反过来说，任何人只要持有密钥就能解密了。如果密钥被攻击者获得，那加密也就失去了意义。  
**共享秘钥加密的困境**  
加密和解密同用一个秘钥的方式被称为共享秘钥加密（Common key crypto system），也被叫做对称秘钥加密。  
以共享密钥方式加密时必须将密钥也发给对方。可究竟怎样才能安全地转交？在互联网上转发密钥时，如果通信被监听那么密钥就可会落入攻击者之手，同时也就失去了加密的意义。另外还得设法安全地保管接收到的密钥。  
**使用两把秘钥的公开秘钥加密**  
公开秘钥加密方式很好地解决了共享秘钥加密的困难。  
公开秘钥加密使用一对非对称的秘钥。一把叫做私有秘钥（private key），另一把叫做公开秘钥（public key）。顾名思义，私有秘钥不能让其他任何人知道，而公开秘钥则可以随意发布，任何人都可以得到。  
使用公开秘钥加密方式，发送密文的一方使用对方的公开秘钥进行加密处理，对方收到被加密信息后，再使用自己的私有秘钥进行解密。利用这种方式，不需要发送用来解密的私有秘钥，也不必担心秘钥被攻击者窃听而盗走。  
另外，要根据密文和公开秘钥，恢复到信息原文是异常困难的，因为解密过程就是在对离散对数进行求值，这并非轻而易举就能办到。退一步讲，如果能对一个非常大的整数做到快速因式分解，那么密码破解还是存在希望的。但就目前的技术来看不太现实。  
**HTTPS采用混合加密机制**  
HTTPS采用共享秘钥加密和公开秘钥加密两者并用的混合加密机制。若秘钥能够实现安全交换，那么有可能会考虑仅使用公开秘钥加密来通信。但是公开秘钥加密与共享秘钥加密相比，其处理速度要慢。  
所以应充分利用两者各自优势，将多种方法组合起来用于通信。在交换秘钥环节使用秘钥加密方式，之后的建立通信交换报文阶段则使用共享秘钥加密方式。  
### 证明公开秘钥正确性的证书  
遗憾的是，公开密钥加密方式还是存在一些问题的。那就是无法证明公开密钥本身就是货真价实的公开密钥。比如，正准备和某台服务器建立公开密钥加密方式下的通信时，如何证明收到的公开密钥就是原本预想的那台服务器发行的公开密钥。或许在公开密钥传输途中，真正的公开密钥已经被攻击者替换掉了。  
为了解决上述问题，可以使用由数字证书认证机构（CA，Certificate Authority）和其相关机关颁发的公开密钥证书。  
**认证机构信誉第一**  
### HTTPS安全通信机制  
步骤一：客户端通过发送Client Hello报文开始SSL通信。报文中包含客户端支持的SSL的指定版本、加密组件（Cipher Suite）列表（所使用的加密算法及秘钥长度等）。  
步骤二：服务器可进行SSL通信时，会以Server Hello报文作为应答。和客户端一样，在报文中包含SSL版本以及加密组件。服务器的加密组件内容是从接收到的客户端加密组件内筛选出来的。  
步骤三：之后服务器发送Certificate报文。报文中包含公开密钥证书。  
步骤四：最后服务器发送Server Hello Done报文通知客户端，最初阶段的SSL握手协商部分结束。  
步骤五：：SSL第一次握手结束之后，客户端以Client Key Exchange报文作为回应。报文中包含通信加密中使用的一种被称为Pre-master secret的随机密码串。该报文已用步骤3中的公开密钥进行加密。  
步骤六：接着客户端继续发送Change Cipher Spec报文。该报文会提示服务器，在此报文之后的通信会采用Pre-master secret密钥加密。  
步骤七：客户端发送Finished报文。该报文包含连接至今全部报文的整体校验值。这次握手协商是否能够成功，要以服务器是否能够正确解密该报文作为判定标准。  
步骤八：服务器同样发送Change Cipher Spec报文。
步骤九：服务器同样发送Finished报文。  
步骤十：服务器和客户端的Finished报文交换完毕之后，SSL连接就算建立完成。当然，通信会受到SSL的保护。从此处开始进行应用层协议的通信，即发送HTTP请求。  
步骤十一：应用层协议通信，即发送HTTP响应。  
步骤十二：最后由客户端断开连接。断开连接时，发送close_notify报文。上图做了一些省略，这步之后再发送TCP FIN报文来关闭与TCP的通信。  
**SSL和TLS**  
HTTPS使用SSL(Secure Socket Layer)和TLS（Transport Layer Security）这两个协议。  
SSL技术最初是由浏览器开发商网景通信公司率先提倡的，开发过SSL3.0之前的版本。目前主导权已转移到IETF（Internet Engineering Task Force，Internet 工程任务组）的手中。  
IETF以SSL3.0为基准，后又制定了TLS1.0、TLS1.1和TLS1.2。TSL是以SSL为原型开发的协议，有时会统一称该协议为SSL。当前主流的版本是SSL3.0和TLS1.0。  
由于SSL1.0协议在设计之初被发现出了问题，就没有实际投入使用。SSL2.0也被发现存在问题，所以很多浏览器直接废除了该协议版本。  
**SSL速度慢吗**  
HTTPS也存在一些问题，那就是当使用SSL时，它的处理速度会变慢。  
SSL的慢分两种。一种是指通信慢。另一种是指由于大量消耗CPU及内存资源，导致处理速度变慢。  
和使用HTTP相比，网络负载可能会变慢2到100倍。除去和TCP连接、发送HTTP请求/响应以外，还必须进行SSL通信，因此整体上处理通信量不可避免会增加。  
另一点是SSL必须进行加密处理。在服务器和客户端都需要进行加密和解密的运算处理。因此从结果上讲，比起HTTP会更多地消耗服务器和客户端的硬件资源，导致负载增强。  
针对速度变慢这一问题，并没有根本性的解决方案，我们会使用SSL加速器这种（专用服务器）硬件来改善该问题。该硬件为SSL通信专用硬件，相对软件来讲，能够提高数倍SSL的计算速度。仅在SSL处理时发挥SSL加速器的功效，以分担负载。  
为什么不一直使用HTTPS  
既然HTTPS那么安全可靠，那为何所有的Web网站不一直使用HTTPS？  
其中一个原因是，因为与纯文本通信相比，加密通信会消耗更多的CPU及内存资源。如果每次通信都加密，会消耗相当多的资源，平摊到一台计算机上时，能够处理的 请求数量必定也会随之减少。  
因此，如果是非敏感信息则使用HTTP通信，只有在包含个人信息等敏感数据时，才利用HTTPS加密通信。  
特别是每当那些访问量较多的Web网站在进行加密处理时，它们所承担着的负载不容小觑。在进行加密处理时，并非对所有内容都进行加密处理，而是仅在那些需要信息隐藏时才会加密，以节约资源。  
除此之外，想要节约购买证书的开销也是原因之一。  
要进行HTTPS通信，证书是必不可少的。而使用的证书必须向认证机构（CA）购买。证书价格可能会根据不同的认证机构略有不同。通常，一年的授权需要数万日元（现在一万日元大约折合600人民币）。  

























